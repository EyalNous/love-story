<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#fff5f5">
  <title>‚ù§Ô∏è</title>

  <link rel="manifest" href="/love-story/manifest.json">
  <link rel="apple-touch-icon" href="/love-story/icon-192.png">

  <style>
    * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color: transparent; }

    body {
      overflow: hidden;
      position: fixed;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #fff5f5 0%, #ffe4e1 100%);
    }

    #heart-screen {
      position: fixed;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #fff5f5 0%, #ffe4e1 50%, #ffd4d4 100%);
      z-index: 1000;
    }

    .heart {
      font-size: 80px;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%,100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    #book-container { display:none; position:fixed; width:100%; height:100%; }
    #book-container.active { display:block; }

    #pages-wrapper {
      height:100%;
      overflow-y:auto;
      scroll-snap-type:y mandatory;
    }

    .page {
      height:100vh;
      height:100dvh;
      scroll-snap-align:start;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .page-content {
      width:100%;
      height:100%;
      background:white;
    }

    .page-content img {
      width:100%;
      height:100%;
      -o-object-fit:contain;
         object-fit:contain;
    }

    #sound-toggle {
      position:fixed;
      top:20px;
      right:20px;
      width:44px;
      height:44px;
      border:none;
      border-radius:50%;
      display:none;
      align-items:center;
      justify-content:center;
      background:white;
      z-index:100;
    }

    #sound-toggle.visible { display:flex; }
  </style>
</head>

<body>

<div id="heart-screen">
  <div class="heart">‚ù§Ô∏è</div>
</div>

<div id="book-container">
  <button id="sound-toggle">üîä</button>
  <div id="pages-wrapper"></div>
</div>

<audio id="background-music" loop src="/love-story/assets/music.mp3"></audio>

<script>
const BASE = '/love-story/';

const isStandalone =
  window.navigator.standalone === true ||
  window.matchMedia('(display-mode: standalone)').matches;

const heartScreen = document.getElementById('heart-screen');
const bookContainer = document.getElementById('book-container');
const pagesWrapper = document.getElementById('pages-wrapper');
const soundToggle = document.getElementById('sound-toggle');
const bgMusic = document.getElementById('background-music');

let musicStarted = false;
let musicEnabled = false;

if (isStandalone) {
  setTimeout(() => {
    heartScreen.style.display = 'none';
    bookContainer.classList.add('active');
    loadBook();
  }, 1000);
}

function loadBook() {
  for (let i = 0; i < 53; i++) {
    const page = document.createElement('div');
    page.className = 'page';

    const content = document.createElement('div');
    content.className = 'page-content';

    const img = document.createElement('img');
    const ext = i === 0 ? 'jpg' : 'webp';
    img.src = `${BASE}assets/${i}.${ext}`;

    content.appendChild(img);
    page.appendChild(content);
    pagesWrapper.appendChild(page);
  }

  document.addEventListener('touchstart', tryPlayMusic, { once:true });
  document.addEventListener('click', tryPlayMusic, { once:true });
}

function tryPlayMusic() {
  if (musicStarted) return;

  const p = bgMusic.play();

  if (p !== undefined) {
    p.then(() => {
      musicStarted = true;
      musicEnabled = true;
      soundToggle.classList.add('visible');
    }).catch(() => {});
  }
}

soundToggle.addEventListener('click', () => {
  if (musicEnabled) {
    bgMusic.pause();
    musicEnabled = false;
    soundToggle.textContent = 'üîá';
  } else {
    bgMusic.play();
    musicEnabled = true;
    soundToggle.textContent = 'üîä';
  }
});

if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/love-story/service-worker.js');
}
</script>

</body>
</html>
